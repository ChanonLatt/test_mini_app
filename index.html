<!doctype html>
<html>
<head>
<meta name="viewport" content="user-scalable=no, width=device-width, initial-scale=1.0, viewport-fit=cover">

    <style type='text/css'>
        html { font-family:Helvetica; color:#222; margin:0; padding:0; }
        body { margin:0; padding:0; }

        /* Navigation bar style */
        .navbar {
            position: fixed;
            top: 0;
            left: 0;
            right: 0;

            /* Instead of fixed 50px, add safe area inset */
            height: calc(50px + env(safe-area-inset-top));

            background-color: #007AFF; /* iOS blue */
            display: flex;
            align-items: center;
            justify-content: space-between;
            padding: env(safe-area-inset-top) 12px 0 12px; /* push buttons below status bar */
            color: white;
            font-weight: bold;
            z-index: 1000;
            box-sizing: border-box;
        }

        .navbar button {
            background: none;
            border: none;
            color: white;
            font-size: 16px;
        }

        /* New content wrapper */
        .content {
            margin-top: calc(60px + env(safe-area-inset-top)); /* push below nav bar + safe area */
            padding: 12px;
        }

        h1 { color:#FE8FBD; font-size:24px; }
        button { margin:0 3px 10px; font-size:14px; border: 2px solid #000000; }

        .logLine_Native { border-bottom:1px solid #FFA67C; padding:4px 2px; font-family:courier; font-size:12px; }
        .logLine_JS { border-bottom:1px solid #D867D8; padding:4px 2px; font-family:courier; font-size:12px; }
    </style>
</head>
<body>
    <!-- Navigation bar -->
    <div class="navbar">
        <button onclick="closeApp()">⛌</button>
        <span>Sample App 01</span>
        <button onclick="refreshApp()">↻</button>
    </div>

    <!-- Content wrapper -->
    <div class="content">
        <h1>Welcome to Custom Nav App!</h1>
        <div id="buttons"></div>
        <div id="log"></div>
    </div>

    <script>
        var nativeBridge = null
        var uniqueId = 1
        function log(message, data, type) {
            var log = document.getElementById('log')
            var el = document.createElement('div')
            el.className = type == 'native' ? 'logLine_Native' : 'logLine_JS'
            el.innerHTML = uniqueId++ + '. ' + message + ':<br/>' + JSON.stringify(data)
            if (log.children.length) { log.insertBefore(el, log.children[0]) }
            else { log.appendChild(el) }
        }

        function closeApp() {
            log('JS sending handler "show_pop_up" to Native')
            if (!nativeBridge) return
            nativeBridge.callHandler('show_pop_up', {'msg': 'Are you sure want to close this App?'}, function(response) {
                log('Response from Native after send message from JS', response, 'js')
            })
        }

        function refreshApp() {
            nativeBridge.callHandler("update_nav_bar", {
                'visibility': false,
                'color': null
            })
        }

        function setupWKWebViewJavascriptBridge(callback) {
            if (window.WKWebViewJavascriptBridge) { return callback(WKWebViewJavascriptBridge); }
            if (window.WKWVJBCallbacks) { return window.WKWVJBCallbacks.push(callback); }
            window.WKWVJBCallbacks = [callback];
            window.webkit.messageHandlers.iOS_Native_InjectJavascript.postMessage(null)
        }
        
        function initialAction() {
            nativeBridge.callHandler("update_nav_bar", {
                'visibility': false,
                'color': null
            })
        }

        setupWKWebViewJavascriptBridge(function(bridge) {
            nativeBridge = bridge
            nativeBridge.registerHandler('submit_token', function(data, responseCallback) {
                log('JS received token', data, 'native')
                var responseData = { 'Javascript Says':'Thanks bro Native for token' }
                responseCallback(responseData)
            })
            initialAction()
        })
    </script>
</body>
</html>
